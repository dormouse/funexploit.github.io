

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>at和cron学习笔记 &mdash; funexploit 1.0 documentation</title>
    
    <link rel="stylesheet" href="../static/default.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="funexploit 1.0 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">funexploit 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="atcron">
<h1><a class="toc-backref" href="#id12">at和cron学习笔记</a><a class="headerlink" href="#atcron" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#atcron" id="id12">at和cron学习笔记</a><ul>
<li><a class="reference internal" href="#at" id="id13">at</a><ul>
<li><a class="reference internal" href="#id1" id="id14">安装和启动</a></li>
<li><a class="reference internal" href="#id2" id="id15">配置文件</a></li>
<li><a class="reference internal" href="#id3" id="id16">常用选项</a></li>
<li><a class="reference internal" href="#id4" id="id17">时间格式</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cron" id="id18">cron</a><ul>
<li><a class="reference internal" href="#id5" id="id19">安装和启动</a></li>
<li><a class="reference internal" href="#id6" id="id20">配置文件</a></li>
<li><a class="reference internal" href="#id7" id="id21">常用选项</a></li>
<li><a class="reference internal" href="#id8" id="id22">时间和日期格式</a></li>
<li><a class="reference internal" href="#id9" id="id23">疑难问题</a></li>
</ul>
</li>
<li><a class="reference internal" href="#anacron" id="id24">anacron</a><ul>
<li><a class="reference internal" href="#id10" id="id25">安装和启动</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11" id="id26">参考资料</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="at">
<h2><a class="toc-backref" href="#id13">at</a><a class="headerlink" href="#at" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id14">安装和启动</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>emerge sys-process/at

/etc/init.d/atd start
rc-update add atd</pre>
</div>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id15">配置文件</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>/etc/at/at.allow</li>
<li>/etc/at/at.deny</li>
</ul>
<ol class="arabic simple">
<li>root用户不受上述文件的权限限制</li>
<li>如果at.allow存在，只有里面列出的用户可以使用at系列的命令，忽略at.deny</li>
<li>如果at.allow不存在，at.deny中没列出的用户可以使用at系列的命令</li>
</ol>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id16">常用选项</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>at [-V] [-q queue] [-f file] [-mMlv] timespec...
at [-V] [-q queue] [-f file] [-mMkv] [-t time]
at -c job [job...]
atq [-V] [-q queue]
at [-rd] job [job...]
atrm [-V] job [job...]
batch
at -b</pre>
</div>
<ul class="simple">
<li>-l 即[list]，列出任务，相当于atq</li>
<li>-d 即[delete]，删除任务，相当于atrm</li>
<li>-b 即[batch]，在系统空闲时执行任务</li>
<li>-m 即[mail]，任务完成后用邮件通知</li>
<li>-M 可以理解为[Never Mail]，不发送邮件进行通知</li>
<li>-c 将指定的任务需要执行的命令打印到标准输出</li>
</ul>
<p>如果想要在系统空闲时执行命令，需要输入batch命令，然后输入命令或者脚本。
(使用at -b不起作用)</p>
<p>如果同时使用at -b又指定时间，则如果在指定的时间，系统正忙的话，则暂缓执
行，即在随后的时间内系统不忙的时候执行。</p>
<p>batch命令不接受任何选项，包括时间，是一个交互命令。</p>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id17">时间格式</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>at 23:12 2013-3-17    # 2013年3月17日23点12分执行</li>
<li>at now + 5 minutes    # 5分钟后执行</li>
<li>at now + 5 days       # 5天后执行</li>
<li>at 2013-3-17          # 2013年3月17日的此时执行</li>
</ul>
</div>
</div>
<div class="section" id="cron">
<h2><a class="toc-backref" href="#id18">cron</a><a class="headerlink" href="#cron" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id19">安装和启动</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>emerge sys-process/vixie-cron

/etc/init.d/vixie-cron start
rc-update add vixie-cron</pre>
</div>
<p>先搜索 /var/spool/cron/crontabs ，这里会以用户名为文件名分别列出各用户
的crontab文件，不要直接编辑，而应用 crontab 命令编辑。</p>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id20">配置文件</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>/etc/crontab</li>
</ul>
<p>这是系统级的配置文件，存放系统周期性地执行的命令。</p>
<p>用户级的配置文件存放于/var/spool/cron/目录下。cron会每分钟检查并取出其
中的指令。</p>
<ul class="simple">
<li>/etc/cron.allow</li>
<li>/etc/cron.deny</li>
</ul>
<p>关于cron.allow和cron.deny的权限设置同at的一样。</p>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id21">常用选项</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>crontab [-u username] file</p>
<p>crontab [-u username] {-e | -l | -r}</p>
<p>如果后面跟着一个文件的话，会把这个文件提交给cron来周期性地执行。除了不需要指明用户名那一列之外，这个文件的格式与crontab的文件格式相同。</p>
<ul class="simple">
<li>-u 指定用户，而不是当前用户。</li>
<li>-l 列出当前用户的cron命令。</li>
<li>-e 编辑当前用户的cron命令，用 $EDITOR 指定的编辑器。可以用这个命令来修改或者添加新的项。</li>
<li>-r 删除当前用户的所有cron命令。</li>
</ul>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id22">时间和日期格式</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>格式为</p>
<div class="highlight-python"><pre>分钟 小时 日期 月份 星期</pre>
</div>
<ul class="simple">
<li>分钟的范围是0-59，0表示整点。</li>
<li>小时的范围是0-23，0表示零点。</li>
<li>日期的范围是1-31，如果指定了月份，则日期必须是该月的合法日期。</li>
<li>月份的范围是1-12。</li>
<li>星期用0-7表示，0和7都表示星期天。</li>
</ul>
<p>其中可以使用特殊表示：</p>
<ul class="simple">
<li>星号&#8217;*&#8217;表示任意时间。</li>
<li>逗号&#8217;,&#8217;表示并列的时间。</li>
<li>短线&#8217;-&#8216;表示范围。</li>
<li>斜线&#8217;/&#8217;表示周期，例如分钟字段0-59/2表示每2分钟，月份字段*/3表示每隔3个月。</li>
</ul>
<p>例子</p>
<ul class="simple">
<li>17 * * * *         # 每小时第17分钟</li>
<li>25 6 * * *         # 每天的6:25</li>
<li>47 6 * * 0         # 每周日的6:47</li>
<li>52 6 1 * *         # 每个月1号的6:52</li>
</ul>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id23">疑难问题</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>安装并启动cron后，第一次运行时出现错误</p>
<div class="highlight-python"><pre>$ crontab -e
cannot chdir(/var/spool/cron), bailing out.</pre>
</div>
<p>看一下权限：</p>
<div class="highlight-python"><pre># ls /var/spool/ -l | grep cron
drwxr-x--- 4 root cron 4096 Oct 17 09:48 cron</pre>
</div>
<p>这是gentoo出于安全考虑而设置的默认值，如果允许某个用户使用crontab，则需要将其加入cron这个组中：</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># gpasswd -a &lt;username&gt; cron</span>
</pre></div>
</div>
<p>BTW:google了一下，有人说是由于/var/spool/cron文件夹的权限造成的。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># chmod o+rx /var/spool/cron</span>
</pre></div>
</div>
<p>并且像这样修改权限，这实际上是不安全的，这样的话任何人都可以使用crontab了。</p>
</div>
</div>
<div class="section" id="anacron">
<h2><a class="toc-backref" href="#id24">anacron</a><a class="headerlink" href="#anacron" title="Permalink to this headline">¶</a></h2>
<p>anacron的是一个协助cron来工作的程序，对于非24小时连续运行的系统来说，有
很多cron工作在系统关机时会得不到执行，anacron的作用就是执行这些被错过的
cron例程的。</p>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id25">安装和启动</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>emerge sys-process/anacron
/etc/init.d/anacron start
rc-update add anacron</pre>
</div>
</div>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id26">参考资料</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://www.gentoo.org/doc/en/cron-guide.xml">Gentoo Linux Cron Guide</a></li>
<li><a class="reference external" href="http://oss.org.cn/ossdocs/gnu_linux/redhat/rhel-sag-zh_cn-3/ch-autotasks.html">红帽企业 Linux 3: 系统管理指南</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">at和cron学习笔记</a><ul>
<li><a class="reference internal" href="#at">at</a><ul>
<li><a class="reference internal" href="#id1">安装和启动</a></li>
<li><a class="reference internal" href="#id2">配置文件</a></li>
<li><a class="reference internal" href="#id3">常用选项</a></li>
<li><a class="reference internal" href="#id4">时间格式</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cron">cron</a><ul>
<li><a class="reference internal" href="#id5">安装和启动</a></li>
<li><a class="reference internal" href="#id6">配置文件</a></li>
<li><a class="reference internal" href="#id7">常用选项</a></li>
<li><a class="reference internal" href="#id8">时间和日期格式</a></li>
<li><a class="reference internal" href="#id9">疑难问题</a></li>
</ul>
</li>
<li><a class="reference internal" href="#anacron">anacron</a><ul>
<li><a class="reference internal" href="#id10">安装和启动</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">参考资料</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/sources/at_cron.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">funexploit 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, jff.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>